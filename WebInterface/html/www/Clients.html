<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body onload="onLoad()">

    <!-- Ignite UI Required Combined CSS Files -->
    <link href="http://cdn-na.infragistics.com/igniteui/2018.1/latest/css/themes/infragistics/infragistics.theme.css" rel="stylesheet" />
    <link href="http://cdn-na.infragistics.com/igniteui/2018.1/latest/css/structure/infragistics.css" rel="stylesheet" />

    <script src="http://ajax.aspnetcdn.com/ajax/modernizr/modernizr-2.8.3.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>

    <!-- Ignite UI Required Combined JavaScript Files -->
    <script src="http://cdn-na.infragistics.com/igniteui/2018.1/latest/js/infragistics.core.js"></script>
    <script src="http://cdn-na.infragistics.com/igniteui/2018.1/latest/js/infragistics.lob.js"></script>




    <script src="javascript/Constants.js" type="text/javascript"></script>
    <script src="javascript/ui-datagrid-1.2.js" type="text/javascript"></script>
    <script src="javascript/RestClient.js" type="text/javascript"></script>

    <link href="css/datagrid.css" rel="stylesheet" />

    <script type="text/javascript">

        var constants = new Constants();
        constants.Init();

        var clientsGrid = new DataGrid(false, false, false, true);

        var _clients = [];


        function onLoad()
        {
            //var columns = [];
            //columns.push(new DataGridColumn("FirstName", "FirstName", true, false));
            //columns.push(new DataGridColumn("LastName", "LastName", true, false));

            //clientsGrid.Init(document.getElementById("myDataGrid"), columns, "myDataGrid");

            //document.documentElement.addEventListener(DataGrid.EVENT_TYPE_PAGE_CHANGED, pageChanged);
            //document.documentElement.addEventListener(DataGrid.EVENT_TYPE_PAGE_COUNT_CHANGED, pageCountChanged);
            //document.documentElement.addEventListener(DataGrid.EVENT_TYPE_ROW_SELECTED, rowSelected);
            //document.documentElement.addEventListener(DataGrid.EVENT_TYPE_ROW_DELETED, rowDeleted);

            getClients();
        }

        function getClients()
        {
            var restClient = new RestClient(constants.ClientsWebSvcPath);

            restClient.SelectClients(0, 10, function (restCallbackObj)
            {
                //var a = restCallbackObj.ResponseJSON;

                //clientsGrid.AddRecords(a);
                //clientsGrid.SetSelectedRow(0);

                _clients = restCallbackObj.ResponseJSON;
                bind(restCallbackObj.ResponseJSON);
            });
        }

        function bind(clients)
        {
            $("#grid").igGrid({
                primaryKey: "Id",
                caption: "<span> <img src=\"//www.infragistics.com/media/441501/horz_logo.png\" alt=\"Infragistics\"></span>",
                width: '100%',
                columns: [
                    { headerText: "ID", key: "Id", dataType: "number", width: "15%", hidden: true },
                    { headerText: "First Name", key: "FirstName", dataType: "string", width: "15%", hidden: false },
                    //{ headerText: "Image", key: "ImageUrl", dataType: "string", width: "15%", template: "<img style=\"height:50px;\" src=\"${ImageUrl}\"/>" },
                    { headerText: "Last Name", key: "LastName", dataType: "string", width: "25%" }

                ],
                autofitLastColumn: false,
                autoGenerateColumns: false,
                dataSource: clients,
                responseDataKey: "results",
                autoCommit: true,
                features: [
                    {
                        name: "Sorting",
                        sortingDialogContainment: "window"
                    },
                    {
                        name: "Filtering",
                        type: "local",
                        columnSettings: [
                            {
                                columnKey: "ImageUrl",
                                allowFiltering: false
                            },
                            {
                                columnKey: "InStock",
                                condition: "greaterThan"
                            }
                        ]
                    },
                    {
                        name: "GroupBy",
                        columnSettings: [
                            {
                                columnKey: "CategoryName",
                                isGroupBy: true
                            }
                        ]
                    },
                    {
                        name: "Selection"
                    },
                    {
                        name: "Paging",
                        pageSize: 10
                    },
                    {
                        name: "Resizing"
                    },
                    {
                        name: "Updating",
                        editMode: "dialog",
                        enableAddRow: false,
                        columnSettings: [
                            {
                                columnKey: "ImageUrl",
                                readOnly: false
                            }
                        ]
                    }
                ]
            });
        }


        function pageChanged(e)
        {
            var pageNumber = e.detail.DataGrid.GetPageNumber();
        }

        function pageCountChanged(e)
        {

        }

        function rowSelected(e)
        {
            var record = e.detail.SelectedRecord;
            var row = e.detail.SelectedRow;
            var name = e.detail.DataGrid.GetGridName();
        }

        function rowDeleted(e)
        {
            var record = e.detail.SelectedRecord;
            var row = e.detail.SelectedRow;
            var isMultiDelete = e.detail.IsMultiDelete;
        }

        function sendPost()
        {
            var restClient = new RestClient(constants.ClientsWebSvcPath);
            restClient.InsertClient(_clients[0], function (restCallbackObj)
            {
                if (restCallbackObj.StatusCode == 200)
                {

                }
                else
                {

                }
            });
        }

        function sendPut()
        {
            var restClient = new RestClient(constants.ClientsWebSvcPath);
            restClient.UpdateClient(_clients[0], function (restCallbackObj)
            {
                if (restCallbackObj.StatusCode == 200)
                {

                }
                else
                {

                }
            });
        }

        function sendDelete()
        {
            var restClient = new RestClient(constants.ClientsWebSvcPath);
            restClient.DeleteClient(_clients[0].Id, function (restCallbackObj)
            {
                if (restCallbackObj.StatusCode == 200)
                {

                }
                else
                {

                }
            });

        }

    </script>

    <div onclick="sendPost()">POST</div>
    <div onclick="sendDelete()">DELETE</div>
    <div onclick="sendPut()">PUT</div>
    

    <table id="grid"></table>

    <div id="myDataGrid">

    </div>

</body>
</html>